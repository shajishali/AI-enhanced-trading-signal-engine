{% extends 'base.html' %}
{% load static %}

{% block title %}AI Trading Engine - Enhanced Dashboard{% endblock %}

{% block extra_css %}
<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
<link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
<style>
    .dashboard-card {
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        border-radius: 15px;
        color: white;
        transition: transform 0.3s ease;
    }
    .dashboard-card:hover {
        transform: translateY(-5px);
    }
    .signal-card {
        border-left: 4px solid #28a745;
        background: var(--card-bg);
        border-radius: 8px;
        margin-bottom: 15px;
        color: var(--text-color);
    }
    .signal-card.sell {
        border-left-color: #dc3545;
    }
    .metric-card {
        background: var(--card-bg);
        border-radius: 10px;
        box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
        padding: 20px;
        margin-bottom: 20px;
        color: var(--text-color);
    }
    .chart-container {
        background: var(--card-bg);
        border-radius: 10px;
        padding: 20px;
        box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
        color: var(--text-color);
    }
    .navbar-brand {
        font-weight: bold;
        font-size: 1.5rem;
    }
</style>
{% endblock %}

{% block content %}
<div class="container-fluid">
    <div class="row">
        <main class="col-12 px-md-4">
                         <div class="d-flex justify-content-between flex-wrap flex-md-nowrap align-items-center pt-3 pb-2 mb-3 border-bottom">
                 <h1 class="h2">Trading Dashboard</h1>
                 <div class="btn-toolbar mb-2 mb-md-0">
                     <div class="btn-group me-2">
                         <button type="button" class="btn btn-sm btn-outline-secondary">Export</button>
                         <button type="button" class="btn btn-sm btn-outline-secondary">Share</button>
                     </div>
                 </div>
             </div>

            <!-- Key Metrics -->
            <div class="row mb-4">
                <div class="col-xl-3 col-md-6 mb-4">
                    <div class="dashboard-card p-4">
                        <div class="d-flex justify-content-between">
                            <div>
                                <h5 class="text-white-50">Total Signals</h5>
                                <h2 class="mb-0">{{ total_signals|default:"1,247" }}</h2>
                            </div>
                            <div class="align-self-center">
                                <i class="fas fa-signal fa-2x text-white-50"></i>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="col-xl-3 col-md-6 mb-4">
                    <div class="dashboard-card p-4">
                        <div class="d-flex justify-content-between">
                            <div>
                                <h5 class="text-white-50">Win Rate</h5>
                                <h2 class="mb-0">{{ win_rate|default:"73" }}%</h2>
                            </div>
                            <div class="align-self-center">
                                <i class="fas fa-trophy fa-2x text-white-50"></i>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="col-xl-3 col-md-6 mb-4">
                    <div class="dashboard-card p-4">
                        <div class="d-flex justify-content-between">
                            <div>
                                <h5 class="text-white-50">Profit Factor</h5>
                                <h2 class="mb-0">{{ profit_factor|default:"2.8" }}</h2>
                            </div>
                            <div class="align-self-center">
                                <i class="fas fa-chart-line fa-2x text-white-50"></i>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="col-xl-3 col-md-6 mb-4">
                    <div class="dashboard-card p-4">
                        <div class="d-flex justify-content-between">
                            <div>
                                <h5 class="text-white-50">Active Signals</h5>
                                <h2 class="mb-0">{{ active_signals|default:"12" }}</h2>
                            </div>
                            <div class="align-self-center">
                                <i class="fas fa-bolt fa-2x text-white-50"></i>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Charts Row -->
            <div class="row mb-4">
                <div class="col-lg-8">
                    <div class="chart-container">
                        <h5>Performance Chart</h5>
                        <canvas id="performanceChart" width="400" height="200"></canvas>
                    </div>
                </div>
                <div class="col-lg-4">
                    <div class="chart-container">
                        <h5>Signal Distribution</h5>
                        <canvas id="signalChart" width="400" height="200"></canvas>
                    </div>
                </div>
            </div>

            <!-- Recent Signals -->
            <div class="row">
                <div class="col-12">
                    <div class="metric-card">
                        <h5><i class="fas fa-clock"></i> Recent Signals</h5>
                        <div class="row">
                            {% for signal in recent_signals %}
                            <div class="col-md-6 col-lg-4">
                                <div class="signal-card p-3 {% if signal.type == 'SELL' %}sell{% endif %}">
                                    <div class="d-flex justify-content-between align-items-center">
                                        <div>
                                            <h6 class="mb-1">{{ signal.symbol }}</h6>
                                            <small class="text-muted">{{ signal.timestamp }}</small>
                                        </div>
                                        <span class="badge {% if signal.type == 'BUY' %}bg-success{% else %}bg-danger{% endif %}">
                                            {{ signal.type }}
                                        </span>
                                    </div>
                                    <div class="mt-2">
                                        <small>Confidence: {{ signal.confidence }}%</small>
                                        <br>
                                        <small>Price: ${{ signal.price }}</small>
                                    </div>
                                </div>
                            </div>
                            {% empty %}
                            <div class="col-12">
                                <div class="signal-card p-3">
                                    <h6>BTC/USDT</h6>
                                    <span class="badge bg-success">BUY</span>
                                    <small class="text-muted">2 hours ago</small>
                                    <div class="mt-2">
                                        <small>Confidence: 85%</small>
                                        <br>
                                        <small>Price: $45,000</small>
                                    </div>
                                </div>
                            </div>
                            {% endfor %}
                        </div>
                    </div>
                </div>
            </div>
        </main>
    </div>
</div>
{% endblock %}

{% block extra_js %}
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script>
// Performance Chart
const performanceCtx = document.getElementById('performanceChart').getContext('2d');
const performanceChart = new Chart(performanceCtx, {
    type: 'line',
    data: {
        labels: ['Jan', 'Feb', 'Mar', 'Apr', 'May', 'Jun'],
        datasets: [{
            label: 'Portfolio Value',
            data: [10000, 12000, 11500, 14000, 16000, 18000],
            borderColor: 'rgb(75, 192, 192)',
            tension: 0.1
        }]
    },
    options: {
        responsive: true,
        plugins: {
            legend: {
                position: 'top',
            }
        }
    }
});

// Signal Distribution Chart
const signalCtx = document.getElementById('signalChart').getContext('2d');
const signalChart = new Chart(signalCtx, {
    type: 'doughnut',
    data: {
        labels: ['Buy Signals', 'Sell Signals', 'Hold'],
        datasets: [{
            data: [65, 25, 10],
            backgroundColor: [
                'rgb(75, 192, 192)',
                'rgb(255, 99, 132)',
                'rgb(255, 205, 86)'
            ]
        }]
    },
    options: {
        responsive: true,
        plugins: {
            legend: {
                position: 'bottom',
            }
        }
    }
});
</script>
{% endblock %}
